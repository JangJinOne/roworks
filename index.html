<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RoWorks</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/jangjinone/roworks/main/favicon.png">
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/jangjinone/roworks/main/favicon.png">
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <style>
    * { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    
    @keyframes fadeIn { 
      from { opacity: 0; transform: translateY(20px); } 
      to { opacity: 1; transform: translateY(0); } 
    }
    
    @keyframes slideUp { 
      from { transform: translateY(100%); } 
      to { transform: translateY(0); } 
    }
    
    @keyframes slideDown {
      from { transform: translateY(-100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }
    
    .animate-fadeIn { 
      animation: fadeIn 0.5s ease-out forwards; 
    }
    
    .slide-up { 
      animation: slideUp 0.3s ease-out; 
    }
    
    .slide-down {
      animation: slideDown 0.4s ease-out;
    }
    
    .scale-in {
      animation: scaleIn 0.3s ease-out;
    }
    
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .card-hover:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .glass {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
    }
    
    .button-press {
      transition: transform 0.1s ease;
    }
    
    .button-press:active {
      transform: scale(0.95);
    }
    
    .shimmer {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 1000px 100%;
      animation: shimmer 2s infinite;
    }
    
    .bounce-in {
      animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    @keyframes bounceIn {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .fade-in-up {
      animation: fadeInUp 0.6s ease-out;
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .hover-lift {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .hover-lift:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .smooth-appear {
      animation: smoothAppear 0.4s ease-out;
    }
    
    @keyframes smoothAppear {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;
    
    const loadFromStorage = (key, defaultVal) => {
      try {
        const item = localStorage.getItem(key);
        return item ? JSON.parse(item, (_, v) => typeof v === 'string' && v.match(/^\d{4}-\d{2}-\d{2}T/) ? new Date(v) : v) : defaultVal;
      } catch { return defaultVal; }
    };
    
    const saveToStorage = (key, val) => {
      try { localStorage.setItem(key, JSON.stringify(val)); } catch(e) {}
    };
    
    // Firebase sync functions - INSTANT (no throttle)
    const syncToFirebase = async (collection, data) => {
      if (!db) return;
      
      try {
        await db.collection(collection).doc('data').set({ 
          value: data, 
          updatedAt: firebase.firestore.FieldValue.serverTimestamp() 
        });
        console.log(`âœ… Firebase synced instantly: ${collection}`);
      } catch (error) {
        console.error('Firebase sync error:', error);
      }
    };
    
    const loadFromFirebase = async (collection, defaultVal) => {
      if (!db) return defaultVal;
      try {
        const doc = await db.collection(collection).doc('data').get();
        if (doc.exists) {
          return doc.data().value;
        }
        return defaultVal;
      } catch (error) {
        console.error('Firebase load error:', error);
        return defaultVal;
      }
    };
    
    const listenToFirebase = (collection, callback) => {
      if (!db) return () => {};
      try {
        return db.collection(collection).doc('data').onSnapshot((doc) => {
          if (doc.exists) {
            callback(doc.data().value);
          }
        }, (error) => {
          console.error('Firebase listen error:', error);
        });
      } catch (error) {
        console.error('Firebase listener setup error:', error);
        return () => {};
      }
    };

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB7nicWcv0MXSAW_lveL7O0Ifzly1UFKt8",
      authDomain: "roworks-platform.firebaseapp.com",
      projectId: "roworks-platform",
      storageBucket: "roworks-platform.firebasestorage.app",
      messagingSenderId: "259651837686",
      appId: "1:259651837686:web:81187a9ba7fa152b0a96d7"
    };
    
    // Initialize Firebase
    let db = null;
    let auth = null;
    try {
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      db = firebase.firestore();
      auth = firebase.auth();
      console.log('Firebase initialized successfully');
    } catch (error) {
      console.warn('Firebase initialization failed, using localStorage only:', error);
    }

    function App() {
      const [isLoggedIn, setIsLoggedIn] = useState(() => {
        const saved = localStorage.getItem('roworks_logged_in');
        return saved === 'true';
      });
      const [isStaff, setIsStaff] = useState(() => {
        const saved = localStorage.getItem('roworks_is_staff');
        return saved === 'true';
      });
      const [currentUser, setCurrentUser] = useState(() => {
        const saved = localStorage.getItem('roworks_current_user');
        return saved ? JSON.parse(saved) : null;
      });
      const [currentPage, setCurrentPage] = useState('home');
      const [selectedCategory, setSelectedCategory] = useState('all');
      const [searchQuery, setSearchQuery] = useState('');
      const [sortBy, setSortBy] = useState('latest');
      const [showOfficialOnly, setShowOfficialOnly] = useState(false);
      const [selectedItem, setSelectedItem] = useState(null);
      const [showUploadModal, setShowUploadModal] = useState(false);
      const [showStaffLoginModal, setShowStaffLoginModal] = useState(false);
      const [showWarningModal, setShowWarningModal] = useState(false);
      const [warningAccepted, setWarningAccepted] = useState(false);
      const [itemToDownload, setItemToDownload] = useState(null);
      const [favorites, setFavorites] = useState([]);
      const [showSupportModal, setShowSupportModal] = useState(false);
      const [supportMessages, setSupportMessages] = useState(loadFromStorage('roworks_support', []));
      const [newSupportMessage, setNewSupportMessage] = useState('');
      const [showNoticeModal, setShowNoticeModal] = useState(false);
      const [notices, setNotices] = useState(loadFromStorage('roworks_notices', []));
      const [newNotice, setNewNotice] = useState({ title: '', content: '' });
      const [showAllNotices, setShowAllNotices] = useState(false);
      const [comments, setComments] = useState(loadFromStorage('roworks_comments', {}));
      const [newComment, setNewComment] = useState('');
      const [newRating, setNewRating] = useState(5);
      const [showDeleteModal, setShowDeleteModal] = useState(false);
      const [itemToDelete, setItemToDelete] = useState(null);
      const [staffCredentials, setStaffCredentials] = useState({ username: '', password: '' });
      const [detailTab, setDetailTab] = useState('info');
      const [selectedImageIndex, setSelectedImageIndex] = useState(0);
      const [sellerInquiries, setSellerInquiries] = useState(loadFromStorage('roworks_inquiries', {}));
      const [newSellerInquiry, setNewSellerInquiry] = useState('');
      const [replyTexts, setReplyTexts] = useState({});
      const [partners, setPartners] = useState(loadFromStorage('roworks_partners', []));
      const [showPartnerModal, setShowPartnerModal] = useState(false);

      const [uploadForm, setUploadForm] = useState({
        title: '', description: '', category: 'vehicle', warning: '', tags: '', version: 'v1.0', contact: '',
        imagePreviews: ['', '', '', ''], downloadFile: null, downloadFileName: ''
      });

      const [items, setItems] = useState(loadFromStorage('roworks_items', []));
      const [deletedItemIds, setDeletedItemIds] = useState(loadFromStorage('roworks_deleted_items', []));

      const [isInitialized, setIsInitialized] = useState(false);
      const [isSyncing, setIsSyncing] = useState(false); // Prevent sync loops

      // Save to localStorage only (no automatic Firebase sync)
      React.useEffect(() => { 
        if (!isInitialized) return;
        saveToStorage('roworks_items', items); 
      }, [items, isInitialized]);
      
      React.useEffect(() => { 
        if (!isInitialized) return;
        saveToStorage('roworks_deleted_items', deletedItemIds); 
      }, [deletedItemIds, isInitialized]);
      
      React.useEffect(() => { 
        if (!isInitialized) return;
        saveToStorage('roworks_notices', notices); 
      }, [notices, isInitialized]);
      
      // Clean up deleted items from items array on mount
      React.useEffect(() => {
        if (deletedItemIds.length > 0) {
          const cleanedItems = items.filter(item => !deletedItemIds.includes(item.id));
          if (cleanedItems.length !== items.length) {
            setItems(cleanedItems);
          }
        }
      }, []);
      React.useEffect(() => { saveToStorage('roworks_comments', comments); }, [comments]);
      React.useEffect(() => { saveToStorage('roworks_inquiries', sellerInquiries); }, [sellerInquiries]);
      React.useEffect(() => { saveToStorage('roworks_support', supportMessages); }, [supportMessages]);
      React.useEffect(() => { saveToStorage('roworks_partners', partners); }, [partners]);
      
      // Check for Discord OAuth token on load
      React.useEffect(() => {
        const hash = window.location.hash;
        if (hash && hash.includes('access_token') && !isLoggedIn) {
          handleTestLogin();
        }
      }, []);
      
      // Listen for storage changes (cross-tab sync)
      React.useEffect(() => {
        const handleStorageChange = (e) => {
          if (e.key === 'roworks_deleted_items') {
            const deletedIds = loadFromStorage('roworks_deleted_items', []);
            setDeletedItemIds(deletedIds);
            // Remove deleted items from current items
            setItems(prevItems => prevItems.filter(item => !deletedIds.includes(item.id)));
          }
          if (e.key === 'roworks_items') {
            const storedItems = loadFromStorage('roworks_items', []);
            const currentDeletedIds = loadFromStorage('roworks_deleted_items', []);
            setItems(storedItems.filter(item => !currentDeletedIds.includes(item.id)));
          }
          if (e.key === 'roworks_notices') {
            setNotices(loadFromStorage('roworks_notices', []));
          }
        };
        
        window.addEventListener('storage', handleStorageChange);
        return () => window.removeEventListener('storage', handleStorageChange);
      }, []);
      
      // Manual polling instead of real-time listeners (prevents infinite loops)
      React.useEffect(() => {
        if (!db) return;
        
        // Initial load from Firebase
        const loadData = async () => {
          try {
            const itemsDoc = await db.collection('items').doc('data').get();
            const deletedDoc = await db.collection('deletedItems').doc('data').get();
            const noticesDoc = await db.collection('notices').doc('data').get();
            
            if (itemsDoc.exists) {
              const firebaseItems = itemsDoc.data().value || [];
              const deletedIds = deletedDoc.exists ? (deletedDoc.data().value || []) : [];
              const filtered = firebaseItems.filter(item => !deletedIds.includes(item.id));
              
              setIsSyncing(true);
              setItems(filtered);
              saveToStorage('roworks_items', filtered);
              setTimeout(() => setIsSyncing(false), 100);
            }
            
            if (deletedDoc.exists) {
              const firebaseDeleted = deletedDoc.data().value || [];
              setDeletedItemIds(firebaseDeleted);
              saveToStorage('roworks_deleted_items', firebaseDeleted);
            }
            
            if (noticesDoc.exists) {
              const firebaseNotices = noticesDoc.data().value || [];
              setNotices(firebaseNotices);
              saveToStorage('roworks_notices', firebaseNotices);
            }
          } catch (error) {
            console.error('Firebase load error:', error);
          }
        };
        
        loadData();
        
        // Poll every 10 seconds for changes (no real-time listeners)
        const pollInterval = setInterval(loadData, 10000);
        
        // Mark as initialized after first load
        setTimeout(() => setIsInitialized(true), 2000);
        
        return () => {
          clearInterval(pollInterval);
          console.log('Firebase polling stopped');
        };
      }, []); // Empty deps - only run once
      
      // Fallback: localStorage sync for offline mode
      React.useEffect(() => {
        if (db) return; // Skip if Firebase is available
        
        const syncInterval = setInterval(() => {
          const deletedIds = loadFromStorage('roworks_deleted_items', []);
          const storedItems = loadFromStorage('roworks_items', []);
          
          // Update if there are new deleted items
          if (JSON.stringify(deletedIds) !== JSON.stringify(deletedItemIds)) {
            setDeletedItemIds(deletedIds);
            setItems(storedItems.filter(item => !deletedIds.includes(item.id)));
          }
        }, 10000); // Every 10 seconds
        
        return () => clearInterval(syncInterval);
      }, [deletedItemIds]);

      const handleTestLogin = () => {
        // Check if we have token in URL hash (returning from Discord)
        const hash = window.location.hash;
        if (hash && hash.includes('access_token')) {
          const params = new URLSearchParams(hash.substring(1));
          const accessToken = params.get('access_token');
          
          if (accessToken) {
            // Fetch user data from Discord
            fetch('https://discord.com/api/users/@me', {
              headers: {
                'Authorization': `Bearer ${accessToken}`
              }
            })
            .then(res => res.json())
            .then(async user => {
              const avatarUrl = user.avatar 
                ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.${user.avatar.startsWith('a_') ? 'gif' : 'png'}?size=128`
                : `https://cdn.discordapp.com/embed/avatars/${parseInt(user.discriminator) % 5}.png`;
              
              const userData = { 
                name: user.username, 
                avatar: avatarUrl,
                id: user.id,
                discriminator: user.discriminator,
                banner: user.banner
              };
              
              // Firebase Auth - Sign in anonymously with Discord ID
              if (auth) {
                try {
                  await auth.signInAnonymously();
                  console.log('Firebase Auth: Signed in successfully');
                } catch (authError) {
                  console.error('Firebase Auth error:', authError);
                }
              }
              
              setCurrentUser(userData);
              setIsLoggedIn(true);
              
              // Save to localStorage
              localStorage.setItem('roworks_current_user', JSON.stringify(userData));
              localStorage.setItem('roworks_logged_in', 'true');
              localStorage.setItem('roworks_is_staff', 'false');
              
              // Clear hash from URL
              window.history.replaceState(null, null, window.location.pathname);
            })
            .catch(err => {
              console.error('Discord login error:', err);
              alert('Discord ë¡œê·¸ì¸ ì‹¤íŒ¨!');
            });
          }
          return;
        }
        
        // Redirect to Discord OAuth
        const clientId = '1431242474768044070';
        const currentUrl = window.location.href.split('#')[0].split('?')[0];
        const discordAuthUrl = `https://discord.com/api/oauth2/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(currentUrl)}&response_type=token&scope=identify%20guilds`;
        
        console.log('ğŸ” Discord OAuth ë¡œê·¸ì¸');
        console.log('Redirect URL:', currentUrl);
        console.log('Discord Portalì— ì´ URLì„ ë“±ë¡í•˜ì„¸ìš”:', currentUrl);
        
        // Redirect to Discord OAuth
        window.location.href = discordAuthUrl;
      };

      const handleLogout = async () => {
        // Firebase Auth sign out
        if (auth) {
          try {
            await auth.signOut();
            console.log('Firebase Auth: Signed out');
          } catch (error) {
            console.error('Firebase Auth sign-out error:', error);
          }
        }
        
        setIsLoggedIn(false);
        setIsStaff(false);
        setCurrentUser(null);
        
        // Clear localStorage
        localStorage.removeItem('roworks_logged_in');
        localStorage.removeItem('roworks_is_staff');
        localStorage.removeItem('roworks_current_user');
      };

      const handleStaffLogin = async () => {
        // SHA-256 hash function
        const sha256 = async (str) => {
          const encoder = new TextEncoder();
          const data = encoder.encode(str);
          const hash = await crypto.subtle.digest('SHA-256', data);
          return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
        };
        
        // Obfuscated credentials (SHA-256 hashed)
        const validUserHash = '8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918'; // 'admin'
        const validPassHash = '84b89b8c646db778d78c82376c5b142cb1bb82022ffcff58785126f07ae41564'; // 'roworks'
        
        const userHash = await sha256(staffCredentials.username);
        const passHash = await sha256(staffCredentials.password);
        
        if (userHash === validUserHash && passHash === validPassHash) {
          // Firebase Auth - Sign in with admin email
          if (auth) {
            try {
              // Try to sign in with email/password
              await auth.signInWithEmailAndPassword('admin@roworks.com', staffCredentials.password)
                .catch(async (error) => {
                  // If account doesn't exist, create it
                  if (error.code === 'auth/user-not-found') {
                    await auth.createUserWithEmailAndPassword('admin@roworks.com', staffCredentials.password);
                    console.log('Firebase Auth: Admin account created');
                  }
                });
              console.log('Firebase Auth: Admin signed in, UID:', auth.currentUser.uid);
            } catch (authError) {
              console.error('Firebase Auth error:', authError);
            }
          }
          
          const adminData = { name: 'ê´€ë¦¬ì', avatar: 'ğŸ›¡ï¸', id: 'admin', isStaff: true };
          setIsStaff(true);
          setIsLoggedIn(true);
          setCurrentUser(adminData);
          setShowStaffLoginModal(false);
          
          // Save to localStorage
          localStorage.setItem('roworks_current_user', JSON.stringify(adminData));
          localStorage.setItem('roworks_logged_in', 'true');
          localStorage.setItem('roworks_is_staff', 'true');
          
          alert('ê´€ë¦¬ì ë¡œê·¸ì¸ ì„±ê³µ!');
        } else {
          alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
        }
      };

      const handleDownloadClick = (item) => {
        if (!isLoggedIn) {
          alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!');
          return;
        }
        setItemToDownload(item);
        setWarningAccepted(false);
        setShowWarningModal(true);
      };

      const handleConfirmDownload = () => {
        if (warningAccepted && itemToDownload) {
          setItems(items.map(item => 
            item.id === itemToDownload.id ? { ...item, downloads: item.downloads + 1 } : item
          ));
          
          if (itemToDownload.downloadFile) {
            const link = document.createElement('a');
            link.href = itemToDownload.downloadFile;
            link.download = itemToDownload.downloadFileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          } else {
            const content = `RoWorks - ${itemToDownload.title}\n\nì´ íŒŒì¼ì€ ë°ëª¨ì…ë‹ˆë‹¤.`;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = itemToDownload.downloadFileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
          }
          
          setShowWarningModal(false);
        }
      };

      const toggleFavorite = (itemId) => {
        if (!isLoggedIn) { alert('ë¡œê·¸ì¸ í•„ìš”'); return; }
        setFavorites(favorites.includes(itemId) ? favorites.filter(id => id !== itemId) : [...favorites, itemId]);
      };

      const handleFileChange = (e, type) => {
        const file = e.target.files[0];
        if (!file) return;
        
        // File size limits
        const MAX_IMAGE_SIZE = 5 * 1024 * 1024; // 5MB for images
        const MAX_DOWNLOAD_SIZE = 50 * 1024 * 1024; // 50MB for download files
        
        if (type === 'download') {
          if (file.size > MAX_DOWNLOAD_SIZE) {
            alert(`íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤! ìµœëŒ€ 50MBê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.\ní˜„ì¬ íŒŒì¼: ${(file.size / 1024 / 1024).toFixed(2)}MB`);
            e.target.value = '';
            return;
          }
          setUploadForm({ ...uploadForm, downloadFile: URL.createObjectURL(file), downloadFileName: file.name });
        } else if (type === 'image') {
          if (file.size > MAX_IMAGE_SIZE) {
            alert(`ì´ë¯¸ì§€ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤! ìµœëŒ€ 5MBê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.\ní˜„ì¬ íŒŒì¼: ${(file.size / 1024 / 1024).toFixed(2)}MB`);
            e.target.value = '';
            return;
          }
          const idx = parseInt(e.target.dataset.index);
          const reader = new FileReader();
          reader.onloadend = () => {
            const np = [...uploadForm.imagePreviews];
            np[idx] = reader.result;
            setUploadForm({ ...uploadForm, imagePreviews: np });
          };
          reader.readAsDataURL(file);
        }
      };

      const handleUpload = () => {
        if (!isLoggedIn) { alert('ë¡œê·¸ì¸ í•„ìš”'); return; }
        if (!uploadForm.title || !uploadForm.description) { alert('ì œëª©ê³¼ ì„¤ëª… í•„ìˆ˜'); return; }
        const imgs = uploadForm.imagePreviews.filter(i => i);
        if (imgs.length === 0) { alert('ì´ë¯¸ì§€ 1ê°œ ì´ìƒ í•„ìš”'); return; }
        const newItem = {
          id: Date.now(), title: uploadForm.title, description: uploadForm.description,
          category: uploadForm.category, images: imgs,
          uploader: { name: currentUser.name, avatar: currentUser.avatar, isOfficial: isStaff, contact: uploadForm.contact || 'user@example.com' },
          views: 0, downloads: 0, tags: uploadForm.tags.split(',').map(t => t.trim()).filter(t => t),
          version: uploadForm.version, warning: uploadForm.warning || 'ì œì‘ìë¥¼ ëª…ì‹œí•´ì£¼ì„¸ìš”.',
          createdAt: new Date(), downloadFile: uploadForm.downloadFile, downloadFileName: uploadForm.downloadFileName
        };
        const newItems = [newItem, ...items];
        setItems(newItems);
        
        // Manual Firebase sync (no automatic loop)
        syncToFirebase('items', newItems);
        
        setShowUploadModal(false);
        setUploadForm({ title: '', description: '', category: 'vehicle', warning: '', tags: '', version: 'v1.0', contact: '', imagePreviews: ['', '', '', ''], downloadFile: null, downloadFileName: '' });
        alert('ì—…ë¡œë“œ ì™„ë£Œ!');
      };

      const handleDeleteItem = () => {
        if (itemToDelete) {
          // Add to deleted items list
          setDeletedItemIds([...deletedItemIds, itemToDelete.id]);
          
          // Remove from items
          setItems(items.filter(item => item.id !== itemToDelete.id));
          
          setShowDeleteModal(false);
          setItemToDelete(null);
          
          if (selectedItem && selectedItem.id === itemToDelete.id) {
            setSelectedItem(null);
            setCurrentPage('home');
          }
          
          alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ì ìš©ë©ë‹ˆë‹¤.');
        }
      };

      const handleAddComment = () => {
        if (!isLoggedIn || !newComment.trim()) return;
        const c = { id: Date.now(), user: { name: currentUser.name, avatar: currentUser.avatar }, text: newComment, rating: newRating, createdAt: new Date() };
        setComments({ ...comments, [selectedItem.id]: [...(comments[selectedItem.id] || []), c] });
        setNewComment('');
        setNewRating(5);
      };

      const handleReply = (itemId, inquiryId) => {
        const reply = replyTexts[inquiryId];
        if (!reply || !reply.trim()) return;
        setSellerInquiries({
          ...sellerInquiries,
          [itemId]: sellerInquiries[itemId].map(inq => inq.id === inquiryId ? { ...inq, reply } : inq)
        });
        setReplyTexts({ ...replyTexts, [inquiryId]: '' });
        alert('ë‹µë³€ ì™„ë£Œ!');
      };

      const filteredItems = items.filter(item => {
        // Filter out deleted items
        if (deletedItemIds.includes(item.id)) return false;
        
        if (currentPage === 'favorites' && !favorites.includes(item.id)) return false;
        if (selectedCategory !== 'all' && item.category !== selectedCategory) return false;
        if (showOfficialOnly && !item.uploader.isOfficial) return false;
        if (searchQuery && !item.title.toLowerCase().includes(searchQuery.toLowerCase())) return false;
        return true;
      }).sort((a, b) => {
        if (sortBy === 'latest') return b.createdAt - a.createdAt;
        if (sortBy === 'views') return b.views - a.views;
        if (sortBy === 'downloads') return b.downloads - a.downloads;
        return 0;
      });

      const categories = [
        { id: 'all', name: 'ì „ì²´' },
        { id: 'vehicle', name: 'ì°¨ëŸ‰' },
        { id: 'system', name: 'ì‹œìŠ¤í…œ' },
        { id: 'gfx', name: 'GFX' },
        { id: 'model', name: 'ëª¨ë¸' },
        { id: 'other', name: 'ê¸°íƒ€' }
      ];

      if (currentPage === 'detail' && selectedItem) {
        const isOwner = isLoggedIn && currentUser && selectedItem.uploader.name === currentUser.name;
        return (
          <div className="min-h-screen bg-gray-50">
            <header className="bg-white border-b sticky top-0 z-50">
              <div className="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
                <h1 className="text-xl font-bold cursor-pointer" onClick={() => { setCurrentPage('home'); setSelectedItem(null); }}>RoWorks</h1>
                <button onClick={() => { setCurrentPage('home'); setSelectedItem(null); }} className="px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 font-medium">
                  ëª©ë¡
                </button>
              </div>
            </header>
            <div className="max-w-7xl mx-auto px-6 py-8">
              <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div className="lg:col-span-7">
                  <div className="bg-white rounded-xl border p-4 mb-4">
                    <img src={selectedItem.images[selectedImageIndex]} alt={selectedItem.title} className="w-full h-[500px] object-contain rounded-lg bg-gray-50" />
                  </div>
                  <div className="grid grid-cols-4 gap-3">
                    {selectedItem.images.map((img, idx) => (
                      <div key={idx} onClick={() => setSelectedImageIndex(idx)} className={`cursor-pointer rounded-lg overflow-hidden border-2 ${selectedImageIndex === idx ? 'border-gray-900' : 'border-gray-200'}`}>
                        <img src={img} alt="" className="w-full h-24 object-cover" />
                      </div>
                    ))}
                  </div>
                </div>
                <div className="lg:col-span-5">
                  <div className="bg-white rounded-xl border p-6 sticky top-24">
                    <span className="inline-block px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-bold mb-4">ë¬´ë£Œ ë‹¤ìš´ë¡œë“œ</span>
                    <h1 className="text-2xl font-bold mb-3">{selectedItem.title}</h1>
                    <div className="flex items-center gap-3 mb-4">
                      <span className="text-sm font-medium">{selectedItem.uploader.name}</span>
                      {selectedItem.uploader.isOfficial && <span className="text-xs text-blue-600">âœ“ ì¸ì¦</span>}
                    </div>
                    <div className="space-y-2 mb-6 text-sm border-t border-b py-4">
                      <div className="flex justify-between">
                        <span className="text-gray-600">ì¡°íšŒ</span>
                        <span className="font-medium">{selectedItem.views.toLocaleString()}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">ë‹¤ìš´ë¡œë“œ</span>
                        <span className="font-medium">{selectedItem.downloads.toLocaleString()}</span>
                      </div>
                    </div>
                    <div className="flex gap-3 mb-4">
                      <button onClick={() => toggleFavorite(selectedItem.id)} className="flex-1 px-4 py-2 border-2 rounded-lg hover:bg-gray-50 font-medium flex items-center justify-center gap-2">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill={favorites.includes(selectedItem.id) ? '#ef4444' : 'none'} stroke={favorites.includes(selectedItem.id) ? '#ef4444' : 'currentColor'} strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg>
                        ì°œí•˜ê¸°
                      </button>
                      {isStaff && (
                        <button onClick={() => { setItemToDelete(selectedItem); setShowDeleteModal(true); }} className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium">
                          ì‚­ì œ
                        </button>
                      )}
                    </div>
                    <button onClick={() => handleDownloadClick(selectedItem)} className="w-full px-6 py-3 bg-gray-900 text-white rounded-lg hover:bg-gray-800 font-bold">
                      ë‹¤ìš´ë¡œë“œ
                    </button>
                  </div>
                </div>
              </div>
              <div className="mt-8 bg-white rounded-xl border p-6">
                <div className="border-b flex mb-6">
                  <button onClick={() => setDetailTab('info')} className={`flex-1 px-6 py-4 font-medium ${detailTab === 'info' ? 'border-b-2 border-gray-900 text-gray-900' : 'text-gray-500'}`}>
                    ìƒí’ˆìƒì„¸
                  </button>
                  <button onClick={() => setDetailTab('reviews')} className={`flex-1 px-6 py-4 font-medium ${detailTab === 'reviews' ? 'border-b-2 border-gray-900 text-gray-900' : 'text-gray-500'}`}>
                    ìƒí’ˆí‰
                  </button>
                  <button onClick={() => setDetailTab('seller')} className={`flex-1 px-6 py-4 font-medium ${detailTab === 'seller' ? 'border-b-2 border-gray-900 text-gray-900' : 'text-gray-500'}`}>
                    ê°œë°œì ë¬¸ì˜
                  </button>
                </div>
                
                {detailTab === 'info' && (
                  <>
                    <h2 className="font-bold text-xl mb-4">ìƒí’ˆ ì„¤ëª…</h2>
                    <p className="text-gray-700 mb-6 whitespace-pre-wrap">{selectedItem.description}</p>
                    {selectedItem.warning && (
                      <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                        <h3 className="font-bold mb-2 text-yellow-800">âš  ì£¼ì˜ì‚¬í•­</h3>
                        <p className="text-gray-700">{selectedItem.warning}</p>
                      </div>
                    )}
                  </>
                )}
                
                {detailTab === 'reviews' && (
                  <div>
                    {isLoggedIn ? (
                      <>
                        <div className="mb-8">
                          <h2 className="font-bold text-xl mb-6">ìƒí’ˆí‰</h2>
                          {comments[selectedItem.id]?.map(c => (
                            <div key={c.id} className="mb-6 pb-6 border-b">
                              <div className="flex items-center justify-between mb-2">
                                <div className="flex items-center gap-2">
                                  <span className="font-medium">{c.user.name}</span>
                                  <span className="text-gray-400 text-sm">{'â­'.repeat(c.rating)}</span>
                                </div>
                                {isStaff && (
                                  <button onClick={() => {
                                    if (confirm('ì´ ë¦¬ë·°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                      setComments({
                                        ...comments,
                                        [selectedItem.id]: comments[selectedItem.id].filter(comment => comment.id !== c.id)
                                      });
                                      alert('ë¦¬ë·°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                                    }
                                  }} className="text-red-600 hover:bg-red-50 px-2 py-1 rounded text-sm">
                                    ì‚­ì œ
                                  </button>
                                )}
                              </div>
                              <p className="text-gray-700">{c.text}</p>
                            </div>
                          ))}
                          {(!comments[selectedItem.id] || comments[selectedItem.id].length === 0) && (
                            <p className="text-gray-500 text-center py-8">ì²« ë²ˆì§¸ ìƒí’ˆí‰ì„ ë‚¨ê²¨ë³´ì„¸ìš”</p>
                          )}
                        </div>
                        <div className="border-t pt-6">
                          <h3 className="font-bold mb-3">ìƒí’ˆí‰ ì‘ì„±</h3>
                          <div className="flex gap-1 mb-3">
                            <span className="text-sm mr-2">ë³„ì :</span>
                            {[1, 2, 3, 4, 5].map(r => (
                              <button key={r} onClick={() => setNewRating(r)} className="text-xl">
                                {r <= newRating ? 'â­' : 'â˜†'}
                              </button>
                            ))}
                          </div>
                          <textarea value={newComment} onChange={e => setNewComment(e.target.value)} placeholder="í‰ê°€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”" className="w-full p-3 border rounded-lg mb-3 h-24" />
                          <button onClick={handleAddComment} disabled={!newComment.trim()} className={`px-6 py-2 rounded-lg font-medium ${newComment.trim() ? 'bg-gray-900 text-white' : 'bg-gray-200 text-gray-400'}`}>
                            ë“±ë¡
                          </button>
                        </div>
                      </>
                    ) : (
                      <div className="text-center py-12">
                        <p className="text-gray-600 mb-4">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
                        <button onClick={handleTestLogin} className="px-6 py-3 bg-gray-900 text-white rounded-lg font-medium">
                          ë¡œê·¸ì¸
                        </button>
                      </div>
                    )}
                  </div>
                )}
                
                {detailTab === 'seller' && (
                  <div>
                    <h2 className="font-bold text-xl mb-6">ê°œë°œì ì •ë³´</h2>
                    <div className="bg-gray-50 rounded-lg p-6 mb-6">
                      <div className="flex items-center gap-4 mb-4">
                        {selectedItem.uploader.avatar?.startsWith('http') ? (
                          <img src={selectedItem.uploader.avatar} alt="" className="w-12 h-12 rounded-full" />
                        ) : (
                          <div className="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center text-xl">
                            {selectedItem.uploader.avatar}
                          </div>
                        )}
                        <div>
                          <h3 className="font-bold text-lg">{selectedItem.uploader.name}</h3>
                          {selectedItem.uploader.isOfficial && <span className="text-sm text-blue-600">âœ“ ì¸ì¦ëœ ê°œë°œì</span>}
                        </div>
                      </div>
                      <div className="text-gray-600 text-sm">
                        ì—°ë½ì²˜: {selectedItem.uploader.contact}
                      </div>
                    </div>
                    {sellerInquiries[selectedItem.id] && sellerInquiries[selectedItem.id].length > 0 && (
                      <div className="mb-6">
                        <h3 className="font-bold mb-4">ë¬¸ì˜ ë‚´ì—­</h3>
                        {sellerInquiries[selectedItem.id].map(inq => (
                          <div key={inq.id} className="bg-gray-50 rounded-lg p-4 mb-3">
                            <div className="flex items-start gap-3 mb-3">
                              {inq.user.avatar?.startsWith('http') ? (
                                <img src={inq.user.avatar} alt={inq.user.name} className="w-10 h-10 rounded-full" />
                              ) : (
                                <div className="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-xl">
                                  {inq.user.avatar}
                                </div>
                              )}
                              <div className="flex-1">
                                <div className="font-medium mb-1">{inq.user.name}</div>
                                <p className="text-gray-700">{inq.text}</p>
                              </div>
                            </div>
                            {inq.reply ? (
                              <div className="ml-8 pl-4 border-l-2 border-blue-500">
                                <div className="text-sm text-blue-600 font-medium mb-1">ê°œë°œì ë‹µë³€</div>
                                <p className="text-gray-700 text-sm">{inq.reply}</p>
                              </div>
                            ) : isOwner && (
                              <div className="ml-8">
                                <textarea value={replyTexts[inq.id] || ''} onChange={e => setReplyTexts({ ...replyTexts, [inq.id]: e.target.value })} placeholder="ë‹µë³€ ì‘ì„±..." className="w-full p-2 border rounded-lg text-sm mb-2 h-20" />
                                <button onClick={() => handleReply(selectedItem.id, inq.id)} className="px-4 py-1.5 bg-blue-600 text-white rounded-lg text-sm font-medium">ë‹µë³€í•˜ê¸°</button>
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    )}
                    {isLoggedIn ? (
                      <div>
                        <h3 className="font-bold mb-4">ê°œë°œìì—ê²Œ ë¬¸ì˜í•˜ê¸°</h3>
                        <textarea value={newSellerInquiry} onChange={e => setNewSellerInquiry(e.target.value)} placeholder="ê¶ê¸ˆí•œ ì ì„ ë¬¸ì˜í•´ì£¼ì„¸ìš”..." className="w-full p-4 border rounded-lg mb-3 h-32" />
                        <button onClick={() => {
                          if (!newSellerInquiry.trim()) return;
                          const inq = { id: Date.now(), user: { name: currentUser.name, avatar: currentUser.avatar }, text: newSellerInquiry, createdAt: new Date(), reply: null };
                          setSellerInquiries({ ...sellerInquiries, [selectedItem.id]: [...(sellerInquiries[selectedItem.id] || []), inq] });
                          setNewSellerInquiry('');
                          alert('ë¬¸ì˜ ì „ì†¡!');
                        }} disabled={!newSellerInquiry.trim()} className={`px-6 py-2 rounded-lg font-medium ${newSellerInquiry.trim() ? 'bg-gray-900 text-white' : 'bg-gray-200 text-gray-400'}`}>
                          ë¬¸ì˜ ë³´ë‚´ê¸°
                        </button>
                      </div>
                    ) : (
                      <div className="text-center py-8 bg-gray-50 rounded-lg">
                        <p className="text-gray-600 mb-4">ë¬¸ì˜í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
                        <button onClick={handleTestLogin} className="px-6 py-3 bg-gray-900 text-white rounded-lg font-medium">
                          ë¡œê·¸ì¸
                        </button>
                      </div>
                    )}
                  </div>
                )}
              </div>
            </div>
            {showWarningModal && itemToDownload && (
              <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6">
                <div className="bg-white rounded-lg p-8 max-w-2xl w-full">
                  <h2 className="text-xl font-bold mb-4">âš  ë‹¤ìš´ë¡œë“œ ì „ í™•ì¸</h2>
                  <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                    <p>{itemToDownload.warning}</p>
                  </div>
                  <label className="flex items-center gap-3 mb-6 cursor-pointer">
                    <input type="checkbox" checked={warningAccepted} onChange={e => setWarningAccepted(e.target.checked)} className="w-5 h-5" />
                    <span className="font-medium">ìœ„ ë‚´ìš©ì„ í™•ì¸í–ˆìœ¼ë©° ë™ì˜í•©ë‹ˆë‹¤</span>
                  </label>
                  <div className="flex gap-3">
                    <button onClick={() => setShowWarningModal(false)} className="flex-1 px-6 py-3 border rounded-lg hover:bg-gray-50 font-medium">ì·¨ì†Œ</button>
                    <button onClick={handleConfirmDownload} disabled={!warningAccepted} className={`flex-1 px-6 py-3 rounded-lg font-bold ${warningAccepted ? 'bg-gray-900 text-white' : 'bg-gray-200 text-gray-400'}`}>ë‹¤ìš´ë¡œë“œ</button>
                  </div>
                </div>
              </div>
            )}
            {showDeleteModal && (
              <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6">
                <div className="bg-white rounded-lg p-8 max-w-md w-full">
                  <h2 className="text-xl font-bold mb-4 text-red-600">ê²Œì‹œë¬¼ ì‚­ì œ</h2>
                  <p className="mb-6">ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                  <div className="flex gap-3">
                    <button onClick={() => setShowDeleteModal(false)} className="flex-1 px-6 py-3 border rounded-lg hover:bg-gray-50 font-medium">ì·¨ì†Œ</button>
                    <button onClick={handleDeleteItem} className="flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-bold">ì‚­ì œ</button>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gray-50 pb-20 md:pb-0">
          <header className="bg-white border-b sticky top-0 z-50">
            <div className="max-w-7xl mx-auto px-6 py-4">
              <div className="flex items-center justify-between">
                <h1 className="text-2xl font-black cursor-pointer" onClick={() => { setCurrentPage('home'); setSelectedCategory('all'); }}>RoWorks</h1>
                <div className="flex items-center gap-3">
                  {isLoggedIn ? (
                    <>
                      <button onClick={() => setCurrentPage('favorites')} className={`hidden md:flex px-4 py-2 text-sm font-medium ${currentPage === 'favorites' ? 'text-gray-900' : 'text-gray-700 hover:text-gray-900'} items-center gap-2`}>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill={currentPage === 'favorites' ? 'currentColor' : 'none'} stroke="currentColor" strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg>
                        ì°œ ëª©ë¡
                      </button>
                      {isStaff && (
                        <>
                          <button onClick={() => setShowNoticeModal(true)} className="hidden md:flex px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 items-center gap-2">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
                            ê³µì§€ì‚¬í•­
                          </button>
                          <button onClick={() => setShowPartnerModal(true)} className="hidden md:flex px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 items-center gap-2">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                            íŒŒíŠ¸ë„ˆ
                          </button>
                        </>
                      )}
                      <button onClick={() => setShowUploadModal(true)} className="px-5 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 font-medium text-sm flex items-center gap-2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        ì—…ë¡œë“œ
                      </button>
                      {isStaff ? (
                        <div className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium text-sm">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                          ê´€ë¦¬ì
                        </div>
                      ) : (
                        <div className="flex items-center gap-2 px-3 py-2 bg-white border rounded-lg hover:bg-gray-50 transition-colors">
                          <img src={currentUser.avatar} alt={currentUser.name} className="w-8 h-8 rounded-full" />
                          <span className="font-medium text-sm text-gray-900">{currentUser.name}</span>
                        </div>
                      )}
                      <button onClick={handleLogout} className="px-4 py-2 text-gray-600 hover:text-gray-900 text-sm font-medium flex items-center gap-2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                        ë¡œê·¸ì•„ì›ƒ
                      </button>
                    </>
                  ) : (
                    <>
                      <button onClick={() => setShowStaffLoginModal(true)} className="hidden md:flex px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 items-center gap-2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        ê´€ë¦¬ì
                      </button>
                      <button onClick={handleTestLogin} className="px-5 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 font-medium text-sm flex items-center gap-2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        ë¡œê·¸ì¸
                      </button>
                    </>
                  )}
                </div>
              </div>
            </div>
          </header>
          <div className="bg-gradient-to-r from-gray-800 to-gray-900 text-white py-20 fade-in-up">
            <div className="max-w-4xl mx-auto px-6 text-center">
              <h1 className="text-5xl font-bold mb-6 bounce-in">ë¬´ë£Œë°°í¬ì˜ ì°¨ì›ì„ ë„˜ì–´,<br />í¸ë¦¬í•¨ì„ ì¶”êµ¬í•˜ë‹¤</h1>
              <p className="text-xl text-gray-300 mb-10 smooth-appear">ëª¨ë¸ Â· ì‹œìŠ¤í…œ Â· ì°¨ëŸ‰ ë“± ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ í•œ ê³³ì—ì„œ</p>
              <input type="text" placeholder="ì°¾ê³  ì‹¶ì€ ì½˜í…ì¸ ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”..." value={searchQuery} onChange={e => setSearchQuery(e.target.value)} className="w-full max-w-2xl px-5 py-4 rounded-xl text-gray-900 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 scale-in" />
            </div>
          </div>
          {notices.length > 0 && (
            <div className="max-w-7xl mx-auto px-6 -mt-6 relative z-10 smooth-appear">
              <div className="bg-white border rounded-xl p-5 hover-lift">
                <div className="flex justify-between items-start mb-1">
                  <h3 className="font-bold text-gray-900">{notices[0].title}</h3>
                  {isStaff && (
                    <button onClick={() => {
                      if (confirm('ì´ ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        setNotices(notices.filter(n => n.id !== notices[0].id));
                        alert('ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                      }
                    }} className="text-red-600 hover:text-red-700 text-sm font-medium px-3 py-1 hover:bg-red-50 rounded">
                      ì‚­ì œ
                    </button>
                  )}
                </div>
                <p className="text-sm text-gray-700">{notices[0].content}</p>
                {notices.length > 1 && (
                  <button onClick={() => setShowAllNotices(!showAllNotices)} className="text-xs text-blue-600 hover:text-blue-700 mt-2">
                    {showAllNotices ? 'ì ‘ê¸°' : `+ ${notices.length - 1}ê°œ ë”ë³´ê¸°`}
                  </button>
                )}
              </div>
              {showAllNotices && notices.length > 1 && (
                <div className="mt-3 space-y-3">
                  {notices.slice(1).map(notice => (
                    <div key={notice.id} className="bg-white border rounded-xl p-5 hover-lift">
                      <div className="flex justify-between items-start mb-1">
                        <h3 className="font-bold text-gray-900">{notice.title}</h3>
                        {isStaff && (
                          <button onClick={() => {
                            if (confirm('ì´ ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                              setNotices(notices.filter(n => n.id !== notice.id));
                              alert('ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                            }
                          }} className="text-red-600 hover:text-red-700 text-sm font-medium px-3 py-1 hover:bg-red-50 rounded">
                            ì‚­ì œ
                          </button>
                        )}
                      </div>
                      <p className="text-sm text-gray-700">{notice.content}</p>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}
          <div className="bg-white border-y mt-6">
            <div className="max-w-7xl mx-auto px-6 py-4">
              <div className="flex gap-3 flex-wrap items-center justify-between">
                <div className="flex gap-2">
                  {categories.map(cat => {
                    const active = (currentPage === 'home' && selectedCategory === cat.id) || (cat.id === 'all' && currentPage === 'home' && selectedCategory === 'all');
                    return (
                      <button key={cat.id} onClick={() => { if (cat.id === 'all') { setCurrentPage('home'); setSelectedCategory('all'); } else { setSelectedCategory(cat.id); } }} className={`px-4 py-2 rounded-lg font-medium text-sm transition-all duration-300 hover-lift button-press ${active ? 'bg-gray-900 text-white scale-in' : 'bg-white border hover:border-gray-400'}`}>
                        {cat.name}
                      </button>
                    );
                  })}
                </div>
                <div className="flex gap-2 items-center">
                  <select value={sortBy} onChange={e => setSortBy(e.target.value)} className="px-3 py-2 border rounded-lg font-medium text-sm bg-white">
                    <option value="latest">ìµœì‹ ìˆœ</option>
                    <option value="views">ì¡°íšŒìˆœ</option>
                    <option value="downloads">ë‹¤ìš´ë¡œë“œìˆœ</option>
                  </select>
                  <label className="flex items-center gap-2 px-3 py-2 bg-white border rounded-lg cursor-pointer">
                    <input type="checkbox" checked={showOfficialOnly} onChange={e => setShowOfficialOnly(e.target.checked)} className="w-4 h-4" />
                    <span className="font-medium text-sm">Officialë§Œ</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
          <main className="max-w-7xl mx-auto px-6 py-12">
            {currentPage === 'favorites' && (
              <div className="mb-8">
                <h1 className="text-3xl font-bold mb-2">ì°œí•œ ëª©ë¡</h1>
                <p className="text-gray-600">ë‚´ê°€ ì°œí•œ ì½˜í…ì¸ ë¥¼ ëª¨ì•„ë³´ì„¸ìš”</p>
              </div>
            )}
            {filteredItems.length > 0 ? (
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {filteredItems.map((item, i) => (
                  <div key={item.id} className="bg-white border rounded-2xl overflow-hidden hover:shadow-lg transition-shadow animate-fadeIn" style={{ animationDelay: `${i * 0.05}s` }}>
                    <div onClick={() => { 
                      // Increment views
                      setItems(items.map(i => i.id === item.id ? { ...i, views: i.views + 1 } : i));
                      setSelectedItem(item); 
                      setCurrentPage('detail'); 
                      setSelectedImageIndex(0); 
                    }} className="relative h-56 bg-gray-100 cursor-pointer overflow-hidden group">
                      <img src={item.images[0]} alt={item.title} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" />
                      {item.uploader.isOfficial && (
                        <div className="absolute top-3 right-3 bg-black text-white text-xs px-3 py-1.5 rounded-full font-bold">
                          â˜… OFFICIAL
                        </div>
                      )}
                      <div className="absolute bottom-3 left-3 bg-green-500 text-white px-3 py-1.5 rounded-full font-bold text-sm">
                        ë¬´ë£Œ
                      </div>
                    </div>
                    <div className="p-6">
                      <div className="flex items-start justify-between mb-3">
                        <h3 onClick={() => { setSelectedItem(item); setCurrentPage('detail'); setSelectedImageIndex(0); }} className="font-bold text-lg cursor-pointer hover:text-gray-600 flex-1 line-clamp-2">
                          {item.title}
                        </h3>
                        <div className="flex gap-1 ml-2">
                          {isStaff && (
                            <button onClick={e => { e.stopPropagation(); setItemToDelete(item); setShowDeleteModal(true); }} className="p-2 text-red-600 hover:bg-red-50 rounded-lg text-sm">
                              âœ•
                            </button>
                          )}
                          <button onClick={e => { e.stopPropagation(); toggleFavorite(item.id); }} className="p-2 hover:bg-gray-50 rounded-lg">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill={favorites.includes(item.id) ? '#ef4444' : 'none'} stroke={favorites.includes(item.id) ? '#ef4444' : 'currentColor'} strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg>
                          </button>
                        </div>
                      </div>
                      <p className="text-sm text-gray-600 mb-4 line-clamp-2">{item.description}</p>
                      <div className="flex items-center gap-2 text-xs text-gray-500 mb-4">
                        <span className="font-semibold text-gray-700">{item.uploader.name}</span>
                      </div>
                      <div className="flex gap-4 text-sm text-gray-500">
                        <span>ğŸ‘ {item.views.toLocaleString()}</span>
                        <span>â¬‡ {item.downloads.toLocaleString()}</span>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-20">
                <p className="text-gray-500 text-xl font-medium">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
              </div>
            )}
          </main>
          <div className="fixed bottom-0 left-0 right-0 bg-white border-t z-40 md:hidden">
            <div className="flex justify-around py-3">
              <button onClick={() => { setCurrentPage('home'); setSelectedCategory('all'); }} className={`flex flex-col items-center gap-1 px-6 py-2 ${currentPage === 'home' ? 'text-gray-900' : 'text-gray-400'}`}>
                <svg width="24" height="24" viewBox="0 0 24 24" fill={currentPage === 'home' ? 'currentColor' : 'none'} stroke="currentColor" strokeWidth="2"><path d="m3 9 9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                <span className="text-xs font-medium">í™ˆ</span>
              </button>
              {isLoggedIn && (
                <button onClick={() => setCurrentPage('favorites')} className={`flex flex-col items-center gap-1 px-6 py-2 ${currentPage === 'favorites' ? 'text-gray-900' : 'text-gray-400'}`}>
                  <svg width="24" height="24" viewBox="0 0 24 24" fill={currentPage === 'favorites' ? 'currentColor' : 'none'} stroke="currentColor" strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg>
                  <span className="text-xs font-medium">ì°œ</span>
                </button>
              )}
              <button className="flex flex-col items-center gap-1 px-6 py-2 text-gray-400">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m9-9h-6m-6 0H3"/></svg>
                <span className="text-xs font-medium">ì„¤ì •</span>
              </button>
            </div>
          </div>
          {showUploadModal && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6 overflow-y-auto animate-fadeIn">
              <div className="bg-white rounded-lg p-8 max-w-3xl w-full my-8 scale-in">
                <h2 className="text-2xl font-bold mb-6">ì½˜í…ì¸  ì—…ë¡œë“œ</h2>
                <div className="space-y-5">
                  <div>
                    <label className="block font-semibold mb-2">ì œëª© *</label>
                    <input type="text" value={uploadForm.title} onChange={e => setUploadForm({ ...uploadForm, title: e.target.value })} className="w-full p-3 border rounded-lg" />
                  </div>
                  <div>
                    <label className="block font-semibold mb-2">ì„¤ëª… *</label>
                    <textarea value={uploadForm.description} onChange={e => setUploadForm({ ...uploadForm, description: e.target.value })} className="w-full p-3 border rounded-lg h-24 resize-none" />
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block font-semibold mb-2">ì¹´í…Œê³ ë¦¬</label>
                      <select value={uploadForm.category} onChange={e => setUploadForm({ ...uploadForm, category: e.target.value })} className="w-full p-3 border rounded-lg bg-white">
                        <option value="vehicle">ì°¨ëŸ‰</option>
                        <option value="system">ì‹œìŠ¤í…œ</option>
                        <option value="gfx">GFX</option>
                        <option value="model">ëª¨ë¸</option>
                        <option value="other">ê¸°íƒ€</option>
                      </select>
                    </div>
                    <div>
                      <label className="block font-semibold mb-2">ë²„ì „</label>
                      <input type="text" value={uploadForm.version} onChange={e => setUploadForm({ ...uploadForm, version: e.target.value })} placeholder="v1.0" className="w-full p-3 border rounded-lg" />
                    </div>
                  </div>
                  <div>
                    <label className="block font-semibold mb-2">ì—°ë½ì²˜</label>
                    <input type="text" value={uploadForm.contact} onChange={e => setUploadForm({ ...uploadForm, contact: e.target.value })} placeholder="email@example.com" className="w-full p-3 border rounded-lg" />
                  </div>
                  <div>
                    <label className="block font-semibold mb-2">íƒœê·¸</label>
                    <input type="text" value={uploadForm.tags} onChange={e => setUploadForm({ ...uploadForm, tags: e.target.value })} placeholder="ì˜ˆ: ì°¨ëŸ‰, ì‹œìŠ¤í…œ" className="w-full p-3 border rounded-lg" />
                  </div>
                  <div>
                    <label className="block font-semibold mb-2">ì£¼ì˜ì‚¬í•­</label>
                    <textarea value={uploadForm.warning} onChange={e => setUploadForm({ ...uploadForm, warning: e.target.value })} className="w-full p-3 border rounded-lg h-20 resize-none" />
                  </div>
                  <div>
                    <label className="block font-semibold mb-2">ë‹¤ìš´ë¡œë“œ íŒŒì¼ *</label>
                    <input type="file" onChange={e => handleFileChange(e, 'download')} className="w-full p-3 border rounded-lg" />
                    {uploadForm.downloadFileName && <p className="text-sm text-gray-600 mt-2">ğŸ“ {uploadForm.downloadFileName}</p>}
                  </div>
                  <div>
                    <label className="block font-semibold mb-2">ì´ë¯¸ì§€ (ìµœì†Œ 1ê°œ, PNG/JPGë§Œ ê°€ëŠ¥) *</label>
                    <div className="grid grid-cols-2 gap-3">
                      {[0, 1, 2, 3].map(idx => (
                        <div key={idx}>
                          <input type="file" data-index={idx} onChange={e => handleFileChange(e, 'image')} className="w-full p-2 border rounded-lg text-sm" accept="image/png,image/jpeg,image/jpg" />
                          {uploadForm.imagePreviews[idx] && <img src={uploadForm.imagePreviews[idx]} alt="" className="w-full h-24 object-cover rounded-lg mt-2 border" />}
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
                <div className="flex gap-3 mt-6">
                  <button onClick={() => setShowUploadModal(false)} className="flex-1 px-6 py-3 border rounded-lg hover:bg-gray-50 font-semibold">ì·¨ì†Œ</button>
                  <button onClick={handleUpload} className="flex-1 px-6 py-3 bg-gray-900 text-white rounded-lg hover:bg-gray-800 font-bold">ì—…ë¡œë“œ</button>
                </div>
              </div>
            </div>
          )}
          {showStaffLoginModal && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6 animate-fadeIn">
              <div className="bg-white rounded-lg p-8 max-w-md w-full scale-in">
                <h2 className="text-2xl font-bold mb-6">ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
                <div className="space-y-4">
                  <div>
                    <label className="block font-semibold mb-2">ì•„ì´ë””</label>
                    <input type="text" value={staffCredentials.username} onChange={e => setStaffCredentials({ ...staffCredentials, username: e.target.value })} className="w-full p-3 border rounded-lg" />
                  </div>
                  <div>
                    <label className="block font-semibold mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" value={staffCredentials.password} onChange={e => setStaffCredentials({ ...staffCredentials, password: e.target.value })} onKeyPress={e => e.key === 'Enter' && handleStaffLogin()} className="w-full p-3 border rounded-lg" />
                  </div>
                </div>
                <div className="flex gap-3 mt-6">
                  <button onClick={() => setShowStaffLoginModal(false)} className="flex-1 px-6 py-3 border rounded-lg hover:bg-gray-50 font-semibold">ì·¨ì†Œ</button>
                  <button onClick={handleStaffLogin} className="flex-1 px-6 py-3 bg-gray-900 text-white rounded-lg hover:bg-gray-800 font-bold">ë¡œê·¸ì¸</button>
                </div>
              </div>
            </div>
          )}
          {showNoticeModal && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6 animate-fadeIn">
              <div className="bg-white rounded-lg p-8 max-w-2xl w-full scale-in">
                <h2 className="text-2xl font-bold mb-6">ê³µì§€ì‚¬í•­ ì‘ì„±</h2>
                <div className="space-y-4">
                  <input type="text" value={newNotice.title} onChange={e => setNewNotice({ ...newNotice, title: e.target.value })} placeholder="ì œëª©" className="w-full p-3 border rounded-lg" />
                  <textarea value={newNotice.content} onChange={e => setNewNotice({ ...newNotice, content: e.target.value })} placeholder="ë‚´ìš©" className="w-full p-3 border rounded-lg h-32 resize-none" />
                </div>
                <div className="flex gap-3 mt-6">
                  <button onClick={() => setShowNoticeModal(false)} className="flex-1 px-6 py-3 border rounded-lg hover:bg-gray-50 font-semibold">ì·¨ì†Œ</button>
                  <button onClick={() => {
                    if (!newNotice.title || !newNotice.content) { alert('ì œëª©ê³¼ ë‚´ìš© í•„ìˆ˜'); return; }
                    setNotices([{ id: Date.now(), ...newNotice, createdAt: new Date() }, ...notices]);
                    setShowNoticeModal(false);
                    setNewNotice({ title: '', content: '' });
                    alert('ê³µì§€ ê²Œì‹œ!');
                  }} className="flex-1 px-6 py-3 bg-gray-900 text-white rounded-lg hover:bg-gray-800 font-bold">ê²Œì‹œ</button>
                </div>
              </div>
            </div>
          )}
          {showDeleteModal && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6 animate-fadeIn">
              <div className="bg-white rounded-lg p-8 max-w-md w-full scale-in">
                <h2 className="text-xl font-bold mb-4 text-red-600">ê²Œì‹œë¬¼ ì‚­ì œ</h2>
                <p className="mb-6">ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                <div className="flex gap-3">
                  <button onClick={() => setShowDeleteModal(false)} className="flex-1 px-6 py-3 border rounded-lg hover:bg-gray-50 font-semibold">ì·¨ì†Œ</button>
                  <button onClick={handleDeleteItem} className="flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-bold">ì‚­ì œ</button>
                </div>
              </div>
            </div>
          )}
          {showPartnerModal && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6 animate-fadeIn">
              <div className="bg-white rounded-lg p-8 max-w-md w-full scale-in">
                <h2 className="text-2xl font-bold mb-6">íŒŒíŠ¸ë„ˆ ë¡œê³  ì—…ë¡œë“œ</h2>
                <input type="file" accept="image/*" onChange={(e) => {
                  const file = e.target.files[0];
                  if (file) {
                    const reader = new FileReader();
                    reader.onload = () => {
                      setPartners([...partners, { id: Date.now(), logo: reader.result, createdAt: new Date() }]);
                      setShowPartnerModal(false);
                      alert('íŒŒíŠ¸ë„ˆ ë¡œê³ ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    };
                    reader.readAsDataURL(file);
                  }
                }} className="w-full p-3 border rounded-lg mb-4" />
                {partners.length > 0 && (
                  <div className="mb-4">
                    <h3 className="font-bold mb-3 text-sm">ë“±ë¡ëœ íŒŒíŠ¸ë„ˆ</h3>
                    <div className="grid grid-cols-3 gap-3">
                      {partners.map(p => (
                        <div key={p.id} className="relative group">
                          <img src={p.logo} alt="Partner" className="w-full h-20 object-contain border rounded-lg p-2" />
                          <button onClick={() => {
                            if (confirm('ì´ íŒŒíŠ¸ë„ˆë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                              setPartners(partners.filter(partner => partner.id !== p.id));
                            }
                          }} className="absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                            âœ•
                          </button>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
                <button onClick={() => setShowPartnerModal(false)} className="w-full px-6 py-3 bg-gray-900 text-white rounded-lg hover:bg-gray-800 font-bold">ì™„ë£Œ</button>
              </div>
            </div>
          )}
          {currentPage === 'home' && partners.length > 0 && (
            <div className="bg-white py-16 mt-12 border-t">
              <div className="max-w-7xl mx-auto px-6">
                <h2 className="text-4xl font-bold text-center mb-12 bounce-in">Partners</h2>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-12">
                  {partners.map((partner, i) => (
                    <div key={partner.id} className="relative group flex items-center justify-center p-8 hover:scale-110 transition-transform duration-300 animate-fadeIn" style={{animationDelay: `${i * 0.1}s`}}>
                      <img src={partner.logo} alt="Partner" className="max-w-full max-h-32 object-contain filter grayscale hover:grayscale-0 transition-all duration-300" />
                      {isStaff && (
                        <button onClick={() => {
                          if (confirm('ì´ íŒŒíŠ¸ë„ˆë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            setPartners(partners.filter(p => p.id !== partner.id));
                            alert('íŒŒíŠ¸ë„ˆê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                          }
                        }} className="absolute top-2 right-2 bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700 font-bold text-lg">
                          âœ•
                        </button>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
